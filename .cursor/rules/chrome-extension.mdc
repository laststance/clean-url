---
globs: entrypoints/**/*.ts,wxt.config.ts,manifest.json
description: Chrome extension development patterns and Manifest V3 requirements
---

# Chrome Extension Development

## Manifest V3

Built with **Manifest V3** for modern Chrome extensions:

```json
{
  "manifest_version": 3,
  "name": "Clean URL",
  "version": "1.0.0",
  "permissions": ["tabs", "storage", "contextMenus"],
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "16": "icon-16.png",
      "32": "icon-32.png",
      "48": "icon-48.png",
      "128": "icon-128.png"
    }
  },
  "background": {
    "service_worker": "background.js"
  }
}
```

## Permissions

### Required Permissions
- **`tabs`** - URL navigation via `chrome.tabs.update()`
- **`storage`** - Extension settings persistence
- **`contextMenus`** - Right-click functionality

### Minimal Permissions
- No unnecessary permissions requested
- All permissions justified for core functionality

## Extension Components

### Popup Interface
- **`entrypoints/popup/index.html`** - HTML structure
- **`entrypoints/popup/main.ts`** - UI logic and interactions
- **`entrypoints/popup/style.css`** - Styling

### Background Service Worker
- **`entrypoints/background.ts`** - Badge updates, context menus
- Uses WXT's `defineBackground()` wrapper

### Content Security Policy
- No inline scripts allowed
- External resources restricted
- Safe eval usage patterns

## WXT Framework Patterns

### Entrypoint Definition
```typescript
// popup/main.ts
export default defineContentScript({
  matches: ['<all_urls>'],
  main: () => {
    // Popup logic
  }
});
```

### Background Script
```typescript
// entrypoints/background.ts
export default defineBackground({
  main: () => {
    // Service worker logic
  }
});
```

## Development Workflow

### Building
- `pnpm build` - Production build to `.output/chrome-mv3/`
- `pnpm build:firefox` - Firefox-specific build
- `pnpm zip` - Chrome Web Store package
- `pnpm zip:firefox` - Firefox Add-ons package

### Loading Extension
- Load unpacked extension from `.output/chrome-mv3/`
- Hot reload during development with `pnpm dev`

## Security & Privacy

- **Local processing** - All URL cleaning happens client-side
- **No data collection** - Privacy-first approach
- **Input validation** - All URL processing functions validated
- **CSP compliance** - No unsafe patterns

## Multi-Browser Support

- **Chrome primary** - Optimized for Chrome Manifest V3
- **Firefox support** - Separate build configuration
- **Safari potential** - WXT framework supports Safari Web Extensions